from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options
import time
import csv
import re

chrome_driver_path = 'C:/Users/acer/Downloads/chrome-win64/chrome-win64'

chrome_options = Options()
chrome_options.add_argument("--window-size=1920x1080")

service = Service(chrome_driver_path)

name = []
swing = []
hit = []
score = []
columnLabel = "日時,現地気圧(hPa),海面気圧(hPa),降水量(mm),気温(°C),露点温度(°C),蒸気圧(hPa),湿度(%),風速(m/s),風向,日照時間(h),全天日射量(MJ/㎡),降雪量(cm),積雪量(cm),天気,視程(km),スタジアム名,都道府県,屋内外"

with open("Environment.csv", "w", encoding = "utf-8", newline = "") as file:
    writer = csv.writer(file)
    writer.writerow(columnLabel.split(","))

    driver = webdriver.Chrome(options=chrome_options)
    
    # https://www.data.jma.go.jp/stats/etrn/view/hourly_s1.php?prec_no=67&block_no=47765&year=2025&month=3&day=1&view=
    for month in range(3, 4):
        for day in range(1, 31):
            driver.get("https://www.data.jma.go.jp/stats/etrn/view/hourly_s1.php?prec_no=67&block_no=47765&year=2025&month=" + str(month) + "&day=" + str(day) + "&view=")
            
            time.sleep(2)
            
            row = driver.find_elements(By.XPATH, "//tr[contains(@class, 'mtx')]")
            cells = driver.find_elements(By.XPATH, "//td[contains(@class, 'data_0_0')]")
            
            for i in range(int(len(cells) / 16)):
                date_time = f"2025-{month:02d}-{day:02d} {i + 1}"
                pressureLand = cells[i * 16 + 0].text
                pressureSea = cells[i * 16 + 1].text
                presipitation = cells[i * 16 + 2].text
                temp = cells[i * 16 + 3].text
                DewPoint = cells[i * 16 + 4].text
                steamPressure = cells[i * 16 + 5].text
                humidity = cells[i * 16 + 6].text
                windSpeed = cells[i * 16 + 7].text
                windDirection = cells[i * 16 + 8].text
                sunshine = cells[i * 16 + 9].text
                globalRadiation = cells[i * 16 + 10].text
                snowFall = cells[i * 16 + 11].text
                snowDepth = cells[i * 16 + 12].text
                weather = cells[i * 16 + 13].find_element(By.TAG_NAME, "img").get_attribute("alt")
                visibility = cells[i * 16 + 14].text

                
                # Additional static info
                stadium_name = "Mazda Zoom-Zoom Stadium Hiroshima"
                prefecture = "Hiroshima"
                indoor_outdoor = "Outdoor"

                print([date_time, pressureLand, pressureSea, presipitation, temp, DewPoint, steamPressure, humidity, windSpeed, windDirection, sunshine, globalRadiation, snowFall, snowDepth, weather, visibility, stadium_name, prefecture, indoor_outdoor])

                writer.writerow([date_time, pressureLand, pressureSea, presipitation, temp, DewPoint, steamPressure, humidity, windSpeed, windDirection, sunshine, globalRadiation, snowFall, snowDepth, weather, visibility, stadium_name, prefecture, indoor_outdoor])
            
        driver.quit()
    
